#!/bin/bash
# Chokmah Mobile - Setup Validation Script
# This script validates that your development environment is ready

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                                                                  â•‘"
echo "â•‘           ğŸ” Chokmah Mobile - Setup Validator ğŸ”                â•‘"
echo "â•‘                                                                  â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

PASS=0
FAIL=0

# Function to check command
check_command() {
    if command -v $1 &> /dev/null; then
        echo -e "${GREEN}âœ“${NC} $2: $(command -v $1)"
        ((PASS++))
        return 0
    else
        echo -e "${RED}âœ—${NC} $2 not found"
        ((FAIL++))
        return 1
    fi
}

# Function to check version
check_version() {
    if command -v $1 &> /dev/null; then
        version=$($1 --version 2>&1 | head -1)
        echo -e "${GREEN}âœ“${NC} $2: $version"
        ((PASS++))
        return 0
    else
        echo -e "${RED}âœ—${NC} $2 not installed"
        ((FAIL++))
        return 1
    fi
}

# Function to check file
check_file() {
    if [ -f "$1" ]; then
        echo -e "${GREEN}âœ“${NC} $2"
        ((PASS++))
        return 0
    else
        echo -e "${RED}âœ—${NC} $2 missing"
        ((FAIL++))
        return 1
    fi
}

# Function to check directory
check_dir() {
    if [ -d "$1" ]; then
        echo -e "${GREEN}âœ“${NC} $2"
        ((PASS++))
        return 0
    else
        echo -e "${RED}âœ—${NC} $2 missing"
        ((FAIL++))
        return 1
    fi
}

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  SYSTEM REQUIREMENTS"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

check_version node "Node.js"
check_version npm "npm"

# Check Node version is 18+
if command -v node &> /dev/null; then
    NODE_VERSION=$(node --version | cut -d'v' -f2 | cut -d'.' -f1)
    if [ "$NODE_VERSION" -ge 18 ]; then
        echo -e "${GREEN}âœ“${NC} Node.js version is 18+ (v$NODE_VERSION)"
        ((PASS++))
    else
        echo -e "${YELLOW}âš ${NC} Node.js version should be 18+ (current: v$NODE_VERSION)"
        ((FAIL++))
    fi
fi

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  PROJECT FILES"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

check_file "package.json" "package.json"
check_file "App.js" "App.js"
check_file "app.json" "app.json"
check_file "babel.config.js" "babel.config.js"
check_file "metro.config.js" "metro.config.js"

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  SOURCE STRUCTURE"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

check_dir "src" "src directory"
check_dir "src/navigation" "src/navigation"
check_dir "src/screens" "src/screens"
check_dir "src/components" "src/components"
check_dir "src/redux" "src/redux"
check_dir "src/services" "src/services"
check_dir "src/constants" "src/constants"
check_dir "src/utils" "src/utils"

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  CRITICAL FILES"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

check_file "src/redux/store.js" "Redux store"
check_file "src/navigation/AppNavigator.js" "App navigator"
check_file "src/screens/auth/LoginScreen.js" "Login screen"
check_file "src/screens/auth/RegisterScreen.js" "Register screen"
check_file "src/services/api/axiosInstance.js" "Axios instance"
check_file "src/constants/api.js" "API constants"
check_file "src/constants/colors.js" "Color constants"

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  DEPENDENCIES"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

check_dir "node_modules" "node_modules installed"

if [ -d "node_modules" ]; then
    # Count packages
    PACKAGE_COUNT=$(ls -1 node_modules | wc -l)
    echo -e "${GREEN}âœ“${NC} $PACKAGE_COUNT packages installed"
    ((PASS++))
    
    # Check critical packages
    critical_packages=("expo" "react" "react-native" "@react-navigation/native" "@reduxjs/toolkit" "axios")
    
    for package in "${critical_packages[@]}"; do
        if [ -d "node_modules/$package" ]; then
            echo -e "${GREEN}âœ“${NC} $package installed"
            ((PASS++))
        else
            echo -e "${RED}âœ—${NC} $package NOT installed"
            ((FAIL++))
        fi
    done
else
    echo -e "${RED}âœ—${NC} Dependencies not installed. Run: npm install"
fi

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  DOCUMENTATION"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

check_file "README.md" "README.md"
check_file "QUICKSTART.md" "QUICKSTART.md"
check_file "TESTING_GUIDE.md" "TESTING_GUIDE.md"
check_file "CONTRIBUTING.md" "CONTRIBUTING.md"

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  API CONFIGURATION"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

if [ -f "src/constants/api.js" ]; then
    API_URL=$(grep "API_BASE_URL" src/constants/api.js | head -1)
    if [ ! -z "$API_URL" ]; then
        echo -e "${GREEN}âœ“${NC} API URL configured: $API_URL"
        ((PASS++))
    else
        echo -e "${RED}âœ—${NC} API URL not found in src/constants/api.js"
        ((FAIL++))
    fi
fi

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  SUMMARY"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

TOTAL=$((PASS + FAIL))
PERCENTAGE=$((PASS * 100 / TOTAL))

echo ""
echo "  Total Checks: $TOTAL"
echo -e "  ${GREEN}Passed: $PASS${NC}"
echo -e "  ${RED}Failed: $FAIL${NC}"
echo "  Success Rate: $PERCENTAGE%"
echo ""

if [ $FAIL -eq 0 ]; then
    echo -e "${GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${GREEN}â•‘                                                                  â•‘${NC}"
    echo -e "${GREEN}â•‘                    âœ… ALL CHECKS PASSED! âœ…                      â•‘${NC}"
    echo -e "${GREEN}â•‘                                                                  â•‘${NC}"
    echo -e "${GREEN}â•‘              Your environment is ready for testing!              â•‘${NC}"
    echo -e "${GREEN}â•‘                                                                  â•‘${NC}"
    echo -e "${GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    echo "ğŸš€ Next Steps:"
    echo "   1. Run: npm start"
    echo "   2. Press 'w' for web or scan QR code for mobile"
    echo "   3. Test the app following TESTING_GUIDE.md"
    echo ""
elif [ $FAIL -le 3 ]; then
    echo -e "${YELLOW}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${YELLOW}â•‘                                                                  â•‘${NC}"
    echo -e "${YELLOW}â•‘                  âš ï¸  MINOR ISSUES DETECTED âš ï¸                   â•‘${NC}"
    echo -e "${YELLOW}â•‘                                                                  â•‘${NC}"
    echo -e "${YELLOW}â•‘            Fix the issues above before testing                   â•‘${NC}"
    echo -e "${YELLOW}â•‘                                                                  â•‘${NC}"
    echo -e "${YELLOW}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    echo "ğŸ”§ Recommended Fixes:"
    echo "   - If dependencies missing: npm install"
    echo "   - If Node version low: Update Node.js to 18+"
    echo ""
else
    echo -e "${RED}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${RED}â•‘                                                                  â•‘${NC}"
    echo -e "${RED}â•‘                  âŒ SETUP INCOMPLETE âŒ                          â•‘${NC}"
    echo -e "${RED}â•‘                                                                  â•‘${NC}"
    echo -e "${RED}â•‘          Please fix the issues above before testing              â•‘${NC}"
    echo -e "${RED}â•‘                                                                  â•‘${NC}"
    echo -e "${RED}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    echo "ğŸ”§ Quick Fixes:"
    echo "   1. Install dependencies: npm install"
    echo "   2. Check you're in the right directory"
    echo "   3. Verify all files were properly cloned"
    echo "   4. See README.md for detailed setup"
    echo ""
fi

exit $FAIL
